
# How to create a library.

generic package library (my lib_path:  String)

:>
api
    libh:  String -> Void -> unt32::Unt;
end
{
    fun link s
	=
	dynamic_linkage::open_lib {
	    name   => s,
	    global => TRUE,
	    lazy   => TRUE;
	}
	except
	    e as dynamic_linkage::DYNAMIC_LINK_ERROR msg
		=
		raise exception FAIL (s + ": " + msg);

     path    = case (winix::process::getEnv "SMLNJFFILIBPATH")
		    THE p =>  p;
		    NULL  =>  lib_path;
	       esac;

     library = link path;

     fun libh s
	=
	{   sh =   dynamic_linkage::lib_symbol (library, s);

	    fn () =  dynamic_linkage::address sh;
	};

};
